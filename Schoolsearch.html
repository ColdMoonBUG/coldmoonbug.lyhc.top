<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />
    <title>河南高职本科招生查询系统</title>
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    body{
      font-family:-apple-system,BlinkMacSystemFont,'Segoe UI','Microsoft YaHei',sans-serif;
      background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);
      min-height:100vh;padding:20px
    }
    .container{max-width:1200px;margin:0 auto}
    .header{text-align:center;color:#fff;margin-bottom:30px}
    .header h1{font-size:32px;margin-bottom:10px}
    .header p{font-size:14px;opacity:.9}
    .loading{text-align:center;padding:40px;color:#fff;}
    .loading-spinner{
      border:4px solid rgba(255,255,255,.3);border-top:4px solid #fff;border-radius:50%;
      width:40px;height:40px;animation:spin 1s linear infinite;margin:0 auto 20px
    }
    @keyframes spin{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}
    .error{background:#ff6b6b;color:#fff;padding:20px;border-radius:8px;margin-bottom:20px}
    .toolbar{display:flex;gap:10px;justify-content:space-between;align-items:center;margin-bottom:10px}
    .file-uploader input{display:none}
    .file-uploader label{
      display:inline-block;padding:8px 12px;background:rgba(255,255,255,.2);
      color:#fff;border-radius:6px;cursor:pointer;transition:.3s
    }
    .file-uploader label:hover{background:rgba(255,255,255,.3)}
    .tabs{display:flex;gap:10px;margin:10px 0 20px}
    .tab-btn{
      flex:1;padding:15px;border:none;background:rgba(255,255,255,.2);
      color:#fff;font-size:16px;font-weight:500;cursor:pointer;border-radius:8px 8px 0 0;transition:.3s
    }
    .tab-btn.active{background:#fff;color:#667eea}
    .tab-btn:hover{background:rgba(255,255,255,.3)}
    .tab-content{display:none;background:#fff;border-radius:0 8px 8px 8px;padding:30px;box-shadow:0 10px 30px rgba(0,0,0,.2)}
    .tab-content.active{display:block}
    .search-box{display:flex;gap:10px;margin-bottom:20px;align-items:flex-start}
    .search-wrapper{position:relative;flex:1}
    .search-box input{
      width:100%;padding:12px 15px;border:2px solid #e0e0e0;border-radius:6px;font-size:16px;transition:.3s
    }
    .search-box input:focus{outline:none;border-color:#667eea}
    .search-box button{
      padding:12px 20px;background:#667eea;color:#fff;border:none;border-radius:6px;font-size:16px;
      font-weight:500;cursor:pointer;transition:.3s;white-space:nowrap
    }
    .search-box button:hover{background:#5568d3}
    .filter-tags{display:flex;gap:10px;margin-bottom:20px;flex-wrap:wrap}
    .filter-tag{
      padding:6px 12px;border:1px solid #ddd;border-radius:20px;cursor:pointer;font-size:14px;transition:.2s
    }
    .filter-tag:hover{border-color:#667eea;background:rgba(102,126,234,.08)}
    .filter-tag.active{background:#667eea;color:#fff;border-color:#667eea}
    .results{display:grid;gap:15px}
    .result-card{border:1px solid #e0e0e0;border-radius:8px;padding:20px;transition:.2s;background:#fff}
    .result-card:hover{box-shadow:0 5px 15px rgba(0,0,0,.1);border-color:#667eea}
    .card-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:15px;
      border-bottom:2px solid #f0f0f0;padding-bottom:10px}
    .card-title{font-size:18px;font-weight:600;color:#333}
    .card-code{font-size:12px;color:#999;background:#f5f5f5;padding:3px 8px;border-radius:4px;margin-top:5px;display:inline-block}
    .pill{display:inline-block;font-size:12px;padding:4px 10px;border-radius:999px;margin-left:8px}
    .pill-public{background:#e8f5e9;color:#2e7d32}
    .pill-private{background:#fce4ec;color:#c2185b}
    .pill-new{background:#e3f2fd;color:#1565c0}
    .pill-reduced{background:#fff3e0;color:#e65100}
    .majors-list,.universities-list{display:grid;gap:10px}
    .major-item,.university-item{padding:12px;background:#f9f9f9;border-left:3px solid #667eea;border-radius:4px}
    .major-name,.university-name{font-weight:500;color:#333;margin-bottom:5px}
    .major-code,.university-code{font-size:12px;color:#999;margin-bottom:3px}
    .major-meta{display:flex;gap:10px;flex-wrap:wrap;font-size:12px;color:#666}
    .badge{display:inline-block;padding:3px 8px;border-radius:12px;font-size:11px;font-weight:500}
    .badge-teacher{background:#e8f5e9;color:#2e7d32}
    .badge-art{background:#fce4ec;color:#c2185b}
    .remarks{margin-top:10px;padding:10px;background:#fffbea;border-left:2px solid #ffb300;border-radius:4px;
      font-size:12px;color:#666;white-space:pre-wrap;word-break:break-word}
    .section-title{margin:18px 0 8px;font-weight:600;color:#333;font-size:15px}
    .muted{opacity:.7;font-weight:normal;font-size:13px}
    .no-results{text-align:center;padding:40px 20px;color:#999}
    .stats{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:15px;margin-bottom:20px}
    .stat-box{background:#f5f7fa;padding:15px;border-radius:6px;text-align:center}
    .stat-number{font-size:24px;font-weight:700;color:#667eea}
    .stat-label{font-size:12px;color:#999;margin-top:5px}
    .deleted-section{
      margin-top:15px;padding:15px;background:#fff5f5;border:1px dashed #e74c3c;border-radius:6px;
    }
    .deleted-section h4{
      color:#c0392b;margin:0 0 10px;font-size:14px;border-left:3px solid #c0392b;padding-left:8px
    }
    .info-note{font-size:12px;color:#7f8c8d;margin-bottom:10px}
    /* 自定义下拉样式 */
    .suggestions-dropdown{
      position:absolute;top:100%;left:0;right:0;
      background:#fff;border:2px solid #667eea;border-top:none;
      border-radius:0 0 6px 6px;max-height:300px;overflow-y:auto;
      box-shadow:0 4px 12px rgba(0,0,0,.15);z-index:1000;display:none
    }
    .suggestions-dropdown.show{display:block}
    .suggestion-item{
      padding:10px 15px;cursor:pointer;transition:.2s;
      border-bottom:1px solid #f0f0f0;font-size:14px
    }
    .suggestion-item:last-child{border-bottom:none}
    .suggestion-item:hover,.suggestion-item.active{
      background:#f0f3ff;color:#667eea
    }
    .no-suggestions{padding:15px;text-align:center;color:#999;font-size:13px}
    @media (max-width:768px){
      .header h1{font-size:24px}
      .tabs{flex-direction:column}
      .tab-btn{border-radius:6px}
      .tab-content{border-radius:6px}
      .search-box{flex-direction:column}
      .card-header{flex-direction:column;align-items:flex-start}
      .suggestions-dropdown{max-height:200px;font-size:13px}
      .suggestion-item{padding:12px 15px}
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>🎓 河南高职本科招生查询系统</h1>
      <p>2026年普通高职(专科)毕业生进入本科阶段学习</p>
    </div>
    <div class="toolbar">
      <div></div>
      <div class="file-uploader">
        <input id="fileInput" type="file" accept=".json,application/json"/>
        <label for="fileInput">📥 导入 JSON</label>
      </div>
    </div>
    <div id="loadingContainer" class="loading">
      <div class="loading-spinner"></div>
      <p>正在加载数据...</p>
    </div>
    <div id="mainContent" style="display:none;">
      <div id="errorContainer"></div>
      <div class="tabs">
        <button class="tab-btn active" onclick="switchTab(event,'by-major')">按专业搜招生院校</button>
        <button class="tab-btn" onclick="switchTab(event,'by-university')">按院校搜招生专业</button>
      </div>
      <!-- 按专业搜招生院校 -->
      <div id="by-major" class="tab-content active">
        <div class="search-box">
          <div class="search-wrapper">
            <input type="text" id="majorInput" placeholder="输入专业名称或代码" autocomplete="off"/>
            <div id="majorSuggestions" class="suggestions-dropdown"></div>
          </div>
          <button onclick="searchMajor()">搜索</button>
          <button onclick="clearMajorSearch()" style="background:#e74c3c">清空</button>
        </div>
        <div class="stats">
          <div class="stat-box"><div class="stat-number" id="totalMajors">0</div><div class="stat-label">总专业数</div></div>
          <div class="stat-box"><div class="stat-number" id="totalUniversities">0</div><div class="stat-label">招生院校</div></div>
        </div>
        <div id="majorResults" class="results"></div>
      </div>
      <!-- 按院校搜招生专业 -->
      <div id="by-university" class="tab-content">
        <div class="search-box">
          <div class="search-wrapper">
            <input type="text" id="universityInput" placeholder="输入院校名称或代码" autocomplete="off"/>
            <div id="universitySuggestions" class="suggestions-dropdown"></div>
          </div>
          <button onclick="searchUniversity()">搜索</button>
          <button onclick="clearUniversitySearch()" style="background:#e74c3c">清空</button>
        </div>
        <div class="stats">
          <div class="stat-box"><div class="stat-number" id="searchedUniversities">0</div><div class="stat-label">搜索结果</div></div>
          <div class="stat-box"><div class="stat-number" id="totalPrograms">0</div><div class="stat-label">招生专业</div></div>
        </div>
        <div id="universityResults" class="results"></div>
      </div>
    </div>
  </div>

    <script>
        // ========== 数据存储 ==========
        let allUniversitiesData = [];
        let deletedMajorsData = [];
        let allMajorNames = new Set();
        let allUniversityNames = new Set();

        const cleanName = (name) => name ? name.replace(/\n/g, '').trim() : '';
        const normalize = (s) => (s || '').toLowerCase().replace(/\s+/g, '');

        // ========== Tab 切换 ==========
        function switchTab(evt, id) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            evt.currentTarget.classList.add('active');
        }

        // ========== 数据加载 ==========
        async function loadData() {
            try {
                const response = await fetch('majors_data_updated.json', { cache: 'no-store' });
                if (!response.ok) throw new Error(`HTTP ${response.status}`);
                const data = await response.json();

                allUniversitiesData = data.universities || [];
                deletedMajorsData = data.deleted_majors || [];

                allUniversitiesData.forEach(uni => {
                    allUniversityNames.add(cleanName(uni.university_name));
                    (uni.majors || []).forEach(major => {
                        allMajorNames.add(cleanName(major.major_name));
                    });
                });

                updateSuggestions();
                initStats();
                ready();
            } catch (e) {
                document.getElementById('loadingContainer').style.display = 'none';
                document.getElementById('mainContent').style.display = 'block';
                document.getElementById('errorContainer').innerHTML =
                    `<div class="error">⚠️ 无法自动加载 majors_data_updated.json（${e.message}）。可点击右上角"导入 JSON"。</div>`;
            }
        }

        // ========== 本地导入 ==========
        document.getElementById('fileInput').addEventListener('change', (ev) => {
            const f = ev.target.files?.[0];
            if (!f) return;
            const reader = new FileReader();
            reader.onload = () => {
                try {
                    const data = JSON.parse(reader.result);
                    allUniversitiesData = data.universities || [];
                    deletedMajorsData = data.deleted_majors || [];

                    allMajorNames.clear();
                    allUniversityNames.clear();
                    allUniversitiesData.forEach(uni => {
                        allUniversityNames.add(cleanName(uni.university_name));
                        (uni.majors || []).forEach(major => {
                            allMajorNames.add(cleanName(major.major_name));
                        });
                    });

                    updateSuggestions();
                    initStats();
                    ready();
                } catch (err) {
                    alert('JSON 解析失败：' + err.message);
                }
            };
            reader.readAsText(f, 'utf-8');
        });

        // ========== 自动补全 ==========
        function setupAutocomplete(inputId, suggestionsId, dataSet) {
            const input = document.getElementById(inputId);
            const dropdown = document.getElementById(suggestionsId);
            let currentFocus = -1;
            input.addEventListener('input', function () {
                const val = this.value.trim().toLowerCase();
                dropdown.innerHTML = '';
                dropdown.classList.remove('show');
                currentFocus = -1;
                if (!val) return;
                const matches = Array.from(dataSet).filter(item =>
                    item.toLowerCase().includes(val)
                ).slice(0, 50);
                if (matches.length === 0) {
                    dropdown.innerHTML = '<div class="no-suggestions">无匹配结果</div>';
                    dropdown.classList.add('show');
                    return;
                }
                matches.forEach((item, index) => {
                    const div = document.createElement('div');
                    div.className = 'suggestion-item';
                    div.textContent = item;
                    div.addEventListener('click', () => {
                        input.value = item;
                        dropdown.classList.remove('show');
                    });
                    dropdown.appendChild(div);
                });
                dropdown.classList.add('show');
            });
            input.addEventListener('keydown', function (e) {
                const items = dropdown.getElementsByClassName('suggestion-item');
                if (e.key === 'ArrowDown') {
                    currentFocus++;
                    addActive(items);
                    e.preventDefault();
                } else if (e.key === 'ArrowUp') {
                    currentFocus--;
                    addActive(items);
                    e.preventDefault();
                } else if (e.key === 'Enter') {
                    e.preventDefault();
                    if (currentFocus > -1 && items[currentFocus]) {
                        items[currentFocus].click();
                    } else {
                        inputId === 'majorInput' ? searchMajor() : searchUniversity();
                    }
                } else if (e.key === 'Escape') {
                    dropdown.classList.remove('show');
                }
            });
            function addActive(items) {
                if (!items) return;
                removeActive(items);
                if (currentFocus >= items.length) currentFocus = 0;
                if (currentFocus < 0) currentFocus = items.length - 1;
                items[currentFocus]?.classList.add('active');
                items[currentFocus]?.scrollIntoView({ block: 'nearest' });
            }
            function removeActive(items) {
                Array.from(items).forEach(item => item.classList.remove('active'));
            }
            document.addEventListener('click', (e) => {
                if (e.target !== input) dropdown.classList.remove('show');
            });
        }
        function updateSuggestions() {
            setupAutocomplete('majorInput', 'majorSuggestions', allMajorNames);
            setupAutocomplete('universityInput', 'universitySuggestions', allUniversityNames);
        }

        // ========== 统计信息 ==========
        function initStats() {
            const uniqueMajors = new Set();
            allUniversitiesData.forEach(uni => {
                (uni.majors || []).forEach(m => uniqueMajors.add(m.major_name));
            });
            document.getElementById('totalMajors').textContent = uniqueMajors.size;
            document.getElementById('totalUniversities').textContent = allUniversitiesData.length;
        }

        // ========== 标签渲染 ==========
        const renderTags = (obj, isUni = false) => {
            let tags = '';
            if (isUni) {
                if (obj.is_public === true) tags += `<span class="pill pill-public">公办</span>`;
                if (obj.is_public === false) tags += `<span class="pill pill-private">民办</span>`;
            } else {
                if (obj.is_new) tags += `<span class="pill pill-new">新增</span>`;
                if (obj.is_art) tags += `<span class="badge badge-art">艺术类</span>`;
                if (obj.is_teacher_training) tags += `<span class="badge badge-teacher">师范类</span>`;
            }
            return tags;
        };

        // ========== 按专业搜索 ==========
        function searchMajor() {
            const query = cleanName(document.getElementById('majorInput').value.trim());
            const resultsDiv = document.getElementById('majorResults');

            if (!query) {
                resultsDiv.innerHTML = '<div class="no-results">请输入专业名称或代码</div>';
                return;
            }

            // 在招院校
            const currentResults = [];
            allUniversitiesData.forEach(uni => {
                (uni.majors || []).forEach(major => {
                    if (normalize(cleanName(major.major_name)).includes(normalize(query)) ||
                        normalize(major.major_code || '').includes(normalize(query))) {
                        currentResults.push({ ...uni, matched_major: major });
                    }
                });
            });

            // 已取消专业的院校
            const deletedResults = [];
            deletedMajorsData.forEach(deletedMajor => {
                if (normalize(cleanName(deletedMajor.major_name)).includes(normalize(query))) {
                    deletedResults.push(...(deletedMajor.deleted_universities || []));
                }
            });

            if (currentResults.length === 0 && deletedResults.length === 0) {
                resultsDiv.innerHTML = `<div class="no-results">未找到与"${query}"相关的任何院校信息。</div>`;
                return;
            }

            let html = '';

            // 渲染在招院校
            if (currentResults.length > 0) {
                // 按专业分组
                const majorMap = {};
                currentResults.forEach(res => {
                    const majorName = cleanName(res.matched_major.major_name);
                    if (!majorMap[majorName]) {
                        majorMap[majorName] = {
                            major: res.matched_major,
                            universities: []
                        };
                    }
                    majorMap[majorName].universities.push(res);
                });

                Object.entries(majorMap).forEach(([majorName, data]) => {
                    const major = data.major;
                    const unis = data.universities;

                    html += `
            <div class="result-card">
              <div class="card-header">
                <div>
                  <div class="card-title">${majorName}</div>
                  <div class="card-code">${major.major_code || ''}</div>
                </div>
                <div style="text-align:right;">
                  <div style="font-size:14px;color:#667eea;font-weight:600;">${unis.length} 所院校在招</div>
                </div>
              </div>

              <div class="major-meta">
                <span>学制: ${major.duration || '-'}</span>
                ${major.is_teacher_training ? '<span class="badge badge-teacher">师范</span>' : ''}
                ${major.is_art ? '<span class="badge badge-art">艺术</span>' : ''}
              </div>

              <div class="section-title">在招院校</div>
              <div class="universities-list" style="margin-top:8px;">
                ${unis.map(u => `
                  <div class="university-item">
                    <div class="university-name">
                      ${cleanName(u.university_name)}
                      ${renderTags(u, true)}
                      ${renderTags(u.matched_major)}
                    </div>
                    <div class="university-code">${u.university_code || ''}</div>
                    ${u.matched_major.remarks ? `<div class="remarks">${cleanName(u.matched_major.remarks)}</div>` : ''}
                  </div>
                `).join('')}
              </div>
            </div>
          `;
                });
            }

            // 渲染已取消专业的院校
            if (deletedResults.length > 0) {
                const uniqueDeletedUnis = [...new Set(deletedResults)];
                html += `
          <div class="result-card">
            <div class="deleted-section">
              <h4>⚠️ 已取消该专业的院校（仅供参考）</h4>
              <p class="info-note">根据数据，以下院校在本年度的招生计划中可能已不再包含"${query}"专业。</p>
              <div class="universities-list">
                ${uniqueDeletedUnis.map(uniName => `
                  <div class="university-item" style="border-left-color:#e65100;background:#fff7ed">
                    <div class="university-name">
                      ${cleanName(uniName)}
                      <span class="pill pill-reduced">已取消</span>
                    </div>
                  </div>
                `).join('')}
              </div>
            </div>
          </div>
        `;
            }

            resultsDiv.innerHTML = html;
        }

        // ========== 按院校搜索 ==========
        function searchUniversity() {
            const query = cleanName(document.getElementById('universityInput').value.trim());
            const resultsDiv = document.getElementById('universityResults');

            if (!query) {
                resultsDiv.innerHTML = '<div class="no-results">请输入院校名称或代码</div>';
                return;
            }

            const results = allUniversitiesData.filter(uni =>
                normalize(cleanName(uni.university_name)).includes(normalize(query)) ||
                normalize(uni.university_code || '').includes(normalize(query))
            );

            if (results.length === 0) {
                resultsDiv.innerHTML = `<div class="no-results">未找到名为"${query}"的院校。</div>`;
                return;
            }

            document.getElementById('searchedUniversities').textContent = results.length;
            let totalMaj = 0;
            let html = '';

            results.forEach(uni => {
                const majors = uni.majors || [];
                totalMaj += majors.length;

                html += `
          <div class="result-card">
            <div class="card-header">
              <div>
                <div class="card-title">
                  ${cleanName(uni.university_name)}
                  ${renderTags(uni, true)}
                </div>
                <div class="card-code">${uni.university_code || ''}</div>
              </div>
              <div style="text-align:right;">
                <div style="font-size:14px;color:#667eea;font-weight:600;">${majors.length} 个专业</div>
              </div>
            </div>

            <div class="majors-list">
              ${majors.map(m => `
                <div class="major-item">
                  <div class="major-name">
                    ${cleanName(m.major_name)}
                    ${renderTags(m)}
                  </div>
                  <div class="major-code">${m.major_code || ''}</div>
                  <div class="major-meta">
                    <span>学制: ${m.duration || '-'}</span>
                  </div>
                  ${m.remarks ? `<div class="remarks">${cleanName(m.remarks)}</div>` : ''}
                </div>
              `).join('')}
            </div>
          </div>
        `;
            });

            document.getElementById('totalPrograms').textContent = totalMaj;
            resultsDiv.innerHTML = html;
        }

        // ========== 清空搜索 ==========
        function clearMajorSearch() {
            document.getElementById('majorInput').value = '';
            document.getElementById('majorSuggestions').classList.remove('show');
            document.getElementById('majorResults').innerHTML = '<div class="no-results">请输入专业名称进行查询。</div>';
        }
        function clearUniversitySearch() {
            document.getElementById('universityInput').value = '';
            document.getElementById('universitySuggestions').classList.remove('show');
            document.getElementById('universityResults').innerHTML = '<div class="no-results">请输入院校名称进行查询。</div>';
        }

        // ========== 初始化完成 ==========
        function ready() {
            document.getElementById('loadingContainer').style.display = 'none';
            document.getElementById('mainContent').style.display = 'block';
            document.getElementById('errorContainer').innerHTML = '';
        }

        // ========== 页面加载 ==========
        window.addEventListener('load', loadData);
    </script>
</body>

</html>